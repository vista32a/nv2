# StoryWeaver富文本编辑器功能开发指导手册

**版本**: v1.0  
**更新时间**: 2025-01-16  
**适用对象**: 后续功能开发者（人类开发者或AI助手）

---

## 📋 开发原则与规范

### 🎯 **核心原则**

1. **严格按照07文档分类**: `07 StoryWeaver富文本编辑器功能实现对照表.md` 是功能分类的**最高优先级**依据
2. **功能归属不可违背**: 代码实现位置必须严格按照07文档的功能模块分类
3. **序号连续性**: 每个模块的功能序号必须连续，不得跳号
4. **注释如实记录**: 模块顶部注释只负责统计实际代码实现情况，不具权威性

### ⚠️ **特别注意事项**

- **"3"结尾功能**: 013、023、033、043、053等功能曾经大规模乱套，需特别谨慎
- **跨功能联合**: 某些功能（如023、036、037、051）实际上是同一功能的不同部分，但仍需按07文档严格分类
- **模块名称**: 必须与07文档的功能模块名称完全一致

---

## 🗂️ 当前模块结构与功能分布

### ✅ **已完成模块**

| 模块文件 | 功能范围 | 完成度 | 模块名称 |
|---------|---------|--------|----------|
| `base_editing.py` | 001-007 | 7/7 (100%) | 基础文本编辑功能 |
| `char_format.py` | 008-013 | 6/6 (100%) | 字符格式功能 |
| `paragraph_format.py` | 014-021 | 7/8 (87.5%) | 段落格式功能 |
| `doc_structure.py` | 022-027 | 4/6 (66.7%) | 文档结构功能 |
| `ui_components.py` | 028-032 | 5/5 (100%) | 界面交互功能 |
| `advanced_editing.py` | 033-040 | 3/8 (37.5%) | 高级编辑功能 |
| `doc_management.py` | 041-047 | 3/7 (42.9%) | 文档管理功能 |
| `editing_aids.py` | 048-053 | 1/6 (16.7%) | 编辑辅助功能 |

### 📋 **待创建模块**

根据07文档，还需要创建以下模块：

| 功能范围 | 建议文件名 | 模块名称 | 优先级 |
|---------|-----------|----------|--------|
| 054-060 | `ui_extensions.py` | 界面扩展功能 | 🟡 重要 |
| 061-067 | `view_modes.py` | 视图模式功能 | 🟡 重要 |
| 068-074 | `tables.py` | 表格功能 | 🟢 补充 |
| 075-081 | `media.py` | 媒体功能 | 🟢 补充 |
| 082-088 | `page_setup.py` | 页面设置功能 | 🟢 补充 |
| 089-095 | `personalization.py` | 个性化功能 | 🟢 补充 |
| 096-104 | `novel_universe.py` | Novel Universe专属功能 | 🟣 专属 |

---

## 🛠️ 开发流程与规范

### **第一步：确定功能归属**

1. **查阅07文档**: 确认要实现的功能编号和所属模块
2. **检查序号连续性**: 确保功能序号在模块内是连续的
3. **验证模块存在**: 如果模块不存在，需要先创建模块文件

### **第二步：模块文件结构**

每个模块文件必须包含以下标准结构：

```python
"""
模块名称: [与07文档完全一致的模块名称] ([文件名].py)
模块描述: [简要描述模块功能]

=== 功能目录 ===

📋 07文档功能 (已实现 - X项):
├── XXX - 功能名称 ✅ (方法名)
└── XXX - 功能名称 ✅ (方法名)

📋 07文档功能 (未实现 - X项):
├── XXX - 功能名称 ❌ (功能描述)
└── XXX - 功能名称 ❌ (功能描述)

📋 文档外功能 (辅助方法 - X项):
└── 方法名 ⚙️ (辅助方法描述)

=== 模块统计 ===
- 已实现功能: X/Y (Z%)
- 核心辅助方法: X项
- 总代码行数: ~XXX行

=== 特别说明 ===
- [如有跨模块功能或特殊情况的说明]
"""

from PyQt6.QtWidgets import [必要的导入]
from PyQt6.QtGui import [必要的导入]

class [ModuleName]Mixin:
    """
    功能分类: [模块名称]
    """
    
    def function_name(self):
        """
        功能: XXX - 功能名称
        作用: [详细描述功能作用]
        """
        # 实现代码
        pass
```

### **第三步：实现规范**

1. **方法命名**: 使用描述性的英文名称，如`set_heading_style`、`insert_page_break`
2. **功能注释**: 每个方法必须包含功能编号和详细描述
3. **错误处理**: 适当添加错误检查和用户友好的错误提示
4. **信号连接**: 需要UI更新的功能要调用`self.update_format_actions()`

### **第四步：集成到主程序**

1. **导入模块**: 在`demo_editor.py`中添加导入语句
2. **添加继承**: 将Mixin类添加到`DemoEditor`的继承列表
3. **初始化调用**: 如有必要，在`__init__`方法中调用初始化方法

---

## 🔍 常见问题与解决方案

### **Q1: 功能序号不连续怎么办？**
**A**: 这是严重错误！必须检查07文档，确保模块包含完整的连续序号范围。

### **Q2: 功能跨模块怎么处理？**
**A**: 按07文档严格分类，在注释中说明跨模块关系。参考023、036、037、051的处理方式。

### **Q3: 如何处理QTextEdit原生功能？**
**A**: 在功能目录中标记为"原生支持"，不需要额外实现，但要在统计中计入。

### **Q4: 辅助方法如何归类？**
**A**: 放在"文档外功能"分类中，使用⚙️标记，不计入07文档功能统计。

---

## 📊 开发优先级建议

### 🔴 **高优先级** (核心必需功能)
1. 完善`paragraph_format.py`中的021多级列表
2. 完善`doc_structure.py`中的023、027功能
3. 完善`advanced_editing.py`中的034、035、038-040功能

### 🟡 **中优先级** (重要推荐功能)  
1. 完善`doc_management.py`中的042-047功能
2. 完善`editing_aids.py`中的048-053功能
3. 创建`ui_extensions.py`和`view_modes.py`模块

### 🟢 **低优先级** (有用补充功能)
1. 创建`tables.py`、`media.py`等补充功能模块
2. 实现专业增强功能

---

## 🎯 成功标准

一个功能实现完成的标准：

1. ✅ **功能正常**: 在终端测试功能正常运行
2. ✅ **归属正确**: 严格按照07文档分类放置
3. ✅ **注释准确**: 模块顶部统计信息准确反映实际情况
4. ✅ **集成成功**: 在主程序中正常工作
5. ✅ **用户验收**: 用户测试效果满意

---

**记住**: 07文档是功能分类和管理的最高优先级依据，代码实现位置必须严格遵循！
